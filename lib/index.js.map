{"version":3,"sources":["../src/index.js"],"names":["requireOTF","stopTrackAll","defaultOptions","encoding","method","deferred","resume","forceReload","interval","reloadDelay","proxyHandler","Object","getOwnPropertyNames","Reflect","reduce","handler","trap","applyTrap","Function","prototype","apply","bind","target","arguments","value","primitiveTypeNames","deferredResolver","get","defineProperty","preventCircular","defineProperties","Wrapper","wrap","resolved","undefined","configurable","ReferenceError","globalProps","enabled","extensions","stopTrack","module","resolvedName","resolve","handlerCache","raw","stop","resumeTrack","unload","clean","deep","cache","extensionProps","set","handlingPaths","Set","toString","indexOf","isWrapable","RequireOTFHandler","require","options","assign","fileChanged","deferHandled","stopped","watcher","unwatchFile","close","resolvedBaseName","basename","watch","watchFile","updateFileLock","stopDeferredFileChanged","onload","onunload","rawValue","wrappedValue","allCache","reload","currentCache","tryCall","err","console","error","stack","a","b","Stats","mtime","fileChangeTimeout","setTimeout","clearTimeout","fn","arg","call","revoke","children","i","length","fileName","doRequire","has","add","delete","doRequireOTF","existsSync","Proxy","create","revocable","proxy","key"],"mappings":"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","file":"index.js","sourcesContent":["'use strict';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst defaultOptions = {\r\n  encoding: 'utf8',\r\n  method: 'native',\r\n  deferred: false,\r\n  resume: false,\r\n  forceReload: false,\r\n  interval: 5000,\r\n  reloadDelay: 100,\r\n},\r\nproxyHandler = Object.getOwnPropertyNames(Reflect).reduce((handler, trap) => {\r\n  const applyTrap = Function.prototype.apply.bind(Reflect[trap], null);\r\n  handler[trap] = function(target) {\r\n    arguments[0] = target.value;\r\n    return applyTrap(arguments);\r\n  };\r\n  return handler;\r\n}, {}),\r\nprimitiveTypeNames = ['undefined', 'boolean', 'number', 'string', 'symbol'],\r\ndeferredResolver = {\r\n  get() {\r\n    Object.defineProperty(this, 'value', preventCircular);\r\n    return Object.defineProperties(this, {\r\n      value: { value: Wrapper.wrap(this.resolved()) },\r\n      resolved: { value: undefined }\r\n    }).value;\r\n  },\r\n  configurable: true\r\n},\r\npreventCircular = {\r\n  get() {\r\n    throw new ReferenceError('Deferred object is not yet resolved');\r\n  },\r\n  configurable: true\r\n},\r\nglobalProps = {\r\n  enabled: true\r\n},\r\nextensions = {\r\n  stopTrackAll,\r\n  stopTrack(module) {\r\n    const resolvedName = this.resolve(module);\r\n    if(resolvedName in handlerCache)\r\n      handlerCache[resolvedName].raw.stop();\r\n  },\r\n  resumeTrack(module, forceReload) {\r\n    if(!globalProps.enabled) return;\r\n    const resolvedName = this.resolve(module);\r\n    if(resolvedName in handlerCache)\r\n      handlerCache[resolvedName].raw.resume(forceReload);\r\n  },\r\n  unload(module, clean, deep) {\r\n    unload(this.resolve(module), clean && this.cache, deep);\r\n  }\r\n},\r\nextensionProps = {\r\n  enabled: {\r\n    get() { return globalProps.enabled },\r\n    set(value) {\r\n      globalProps.enabled = value;\r\n      if(!value) stopTrackAll();\r\n    }\r\n  }\r\n},\r\nhandlerCache = {},\r\nhandlingPaths = new Set();\r\n\r\nclass Wrapper {\r\n  constructor(value) { this.value = value; }\r\n  valueOf() { return this.value; }\r\n  toJSON() { return this.value; }\r\n  toString() { return this.value.toString(); }\r\n  static isWrapable(value) {\r\n    return value === null || primitiveTypeNames.indexOf(typeof value) >= 0;\r\n  }\r\n  static wrap(value) {\r\n    return Wrapper.isWrapable(value) ? new Wrapper(value) : value;\r\n  }\r\n}\r\n\r\nclass RequireOTFHandler {\r\n  constructor(require, module, resolvedName, options) {\r\n    Object.assign(this, defaultOptions, options, {\r\n      require, module, resolvedName,\r\n      fileChanged: this.fileChanged.bind(this)\r\n    });\r\n    if(this.deferred) this.deferHandled = true;\r\n  }\r\n  stop() {\r\n    this.stopped = true;\r\n    if(!('watcher' in this)) return;\r\n    if(typeof this.watcher === 'string')\r\n      fs.unwatchFile(this.watcher, this.fileChanged);\r\n    else\r\n      this.watcher.close();\r\n    delete this.watcher;\r\n  }\r\n  resume(forceReload) {\r\n    this.stop();\r\n    this.stopped = false;\r\n    const { require, method, resolvedName, fileChanged } = this;\r\n    switch(method) {\r\n      case 'native':\r\n        this.resolvedBaseName = path.basename(resolvedName);\r\n        this.watcher = fs.watch(resolvedName, fileChanged);\r\n        break;\r\n      case 'polling':\r\n        this.watcher = resolvedName;\r\n        fs.watchFile(resolvedName, this, fileChanged);\r\n        break;\r\n    }\r\n    if(forceReload) this.forceReload();\r\n  }\r\n  forceReload() {\r\n    if(this.updateFileLock || this.deferHandled) return;\r\n    this.updateFileLock = true;\r\n    this.stopDeferredFileChanged();\r\n    const { require, module, resolvedName, onload, onunload, rawValue, wrappedValue } = this,\r\n      allCache = require.cache,\r\n      reload = resolvedName in allCache,\r\n      currentCache = allCache[resolvedName];\r\n    try {\r\n      if(reload)\r\n        tryCall(onunload, this.rawValue);\r\n      delete this.wrappedValue;\r\n      delete allCache[resolvedName];\r\n      this.rawValue = require(module);\r\n      this.wrappedValue = Wrapper.wrap(this.rawValue);\r\n      tryCall(onload, this.rawValue);\r\n    } catch(err) {\r\n      if(reload) {\r\n        allCache[resolvedName] = currentCache;\r\n        this.rawValue = rawValue;\r\n        this.wrappedValue = wrappedValue;\r\n      }\r\n      console.error(err.stack || err);\r\n    } finally {\r\n      this.updateFileLock = false;\r\n    }\r\n  }\r\n  fileChanged(a, b, deferred) {\r\n    const { reloadDelay, resolvedBaseName, fileChanged, updateFileLock } = this;\r\n    if((a instanceof fs.Stats) ?\r\n      a.mtime === b.mtime :\r\n      b !== resolvedBaseName)\r\n      return;\r\n    if(reloadDelay) {\r\n      this.stopDeferredFileChanged();\r\n      if(!deferred && !updateFileLock) {\r\n        this.fileChangeTimeout = setTimeout(fileChanged, reloadDelay, a, b, true);\r\n        return;\r\n      }\r\n    }\r\n    this.forceReload();\r\n  }\r\n  stopDeferredFileChanged() {\r\n    if(!this.fileChangeTimeout) return;\r\n    clearTimeout(this.fileChangeTimeout);\r\n    delete this.fileChangeTimeout;\r\n  }\r\n  get value() {\r\n    if(!('wrappedValue' in this)) {\r\n      if(this.updateFileLock)\r\n        throw new ReferenceError('Object is not yet resolved.');\r\n      if(!this.deferHandled) this.forceReload();\r\n      else {\r\n        this.deferHandled = false;\r\n        if(this.stopped) this.forceReload();\r\n        else this.resume(true);\r\n      }\r\n    }\r\n    return this.wrappedValue;\r\n  }\r\n}\r\n\r\nfunction tryCall(fn, arg) {\r\n  try {\r\n    if(typeof fn === 'function')\r\n      fn.call(null, arg);\r\n  } catch(err) {\r\n    console.error(err.stack || err);\r\n  }\r\n}\r\n\r\nfunction unload(resolvedName, cache, deep) {\r\n  if(resolvedName in handlerCache) {\r\n    const { revoke, raw } = handlerCache[resolvedName];\r\n    try {\r\n      if(cache && (typeof raw.onunload === 'function'))\r\n        raw.onunload.call(null, raw.rawValue);\r\n    } finally {\r\n      raw.stop();\r\n      revoke();\r\n      delete handlerCache[resolvedName];\r\n    }\r\n  }\r\n  if(cache && (resolvedName in cache)) {\r\n    if(deep) {\r\n      const { children } = cache[resolvedName];\r\n      for(let i = 0; i < children.length; i++)\r\n        unload(children[i].fileName, cache, deep);\r\n    }\r\n    delete cache[resolvedName];\r\n  }\r\n}\r\n\r\nfunction doRequire(module, resolvedName) {\r\n  if(handlingPaths.has(resolvedName))\r\n    throw new ReferenceError('Object is not yet resolved.');\r\n  try {\r\n    handlingPaths.add(resolvedName);\r\n    return this(module);\r\n  } finally {\r\n    handlingPaths.delete(resolvedName);\r\n  }\r\n}\r\n\r\nfunction doRequireOTF(module, options) {\r\n  if(!enabled) return this(module);\r\n  const resolvedName = this.resolve(module);\r\n  if(!fs.existsSync(resolvedName))\r\n    return (Wrapper.isWrapable(options) && options.deferred || handlingPaths.has(resolvedName)) ?\r\n      new Proxy(Object.create(null, {\r\n        value: deferredResolver,\r\n        resolved: {\r\n          value: doRequire.bind(this, module),\r\n          configurable: true\r\n        }\r\n      }), proxyHandler) :\r\n      doRequire.call(this, module);\r\n  if(!(resolvedName in handlerCache)) {\r\n    const raw = new RequireOTFHandler(this, module, resolvedName, options);\r\n    handlerCache[resolvedName] = Object.assign({ raw }, Proxy.revocable(raw, proxyHandler));\r\n    raw.resume(true);\r\n  } else if(!Wrapper.isWrapable(options)) {\r\n    if(options.resume)\r\n      handlerCache[resolvedName].raw.resume(options.forceReload);\r\n    else if(options.forceReload)\r\n      handlerCache[resolvedName].raw.forceReload();\r\n  }\r\n  return handlerCache[resolvedName].proxy;\r\n}\r\n\r\nexport function requireOTF(require) {\r\n  return Object.defineProperties(Object.assign(doRequireOTF.bind(require), extensions, require), extensionProps);\r\n}\r\n\r\nexport function stopTrackAll() {\r\n  for(let key in handlerCache)\r\n    handlerCache[resolvedName].raw.stop();\r\n}\r\n"]}